name: Build iOS IPA

on:
    push:
        branches:
            - main
    workflow_dispatch:

jobs:
    build:
        runs-on: macos-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up Flutter
              uses: subosito/flutter-action@v2
              with:
                  flutter-version: "stable"

            - name: Install dependencies
              run: flutter pub get

            - name: Ensure iOS platform exists
              run: flutter create .

            - name: Build unsigned IPA
              run: |
                  flutter build ipa --release --no-codesign

            - name: Upload IPA artifact
              uses: actions/upload-artifact@v4
              with:
                  name: ios-ipa
                  path: build/ios/ipa/*.ipa
